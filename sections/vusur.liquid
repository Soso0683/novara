{% comment %}
  Sección: Logos 2up (auto, paso=1, colores originales)
  Archivo: sections/logos-2up.liquid
{% endcomment %}

<section id="logos2-{{ section.id }}" class="l2up" role="region" aria-label="Logotipos">
  <div class="l2up-vp">
    <div class="l2up-track" style="--visible:2;">
      {%- for block in section.blocks -%}
        <div class="l2up-item" {{ block.shopify_attributes }}>
          {%- if block.settings.logo != blank -%}
            <img
              class="l2up-img"
              src="{{ block.settings.logo | img_url: '300x' }}"
              srcset="{{ block.settings.logo | img_url: '200x' }} 200w, {{ block.settings.logo | img_url: '300x' }} 300w, {{ block.settings.logo | img_url: '400x' }} 400w"
              sizes="(max-width: 640px) 40vw, 20vw"
              alt="{{ block.settings.alt | escape }}"
              loading="lazy"
            >
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>

  <style>
    /* --- Ámbito por id de sección --- */
    #logos2-{{ section.id }}.l2up{
      --gap: 24px;
      --img-h: 42px;
      --visible: 2;
      margin:0; padding:0;
    }
    #logos2-{{ section.id }} .l2up-vp{
      overflow:hidden; width:100%;
    }
    #logos2-{{ section.id }} .l2up-track{
      display:flex; align-items:center; gap:var(--gap);
      will-change:transform;
      transform: translateX(0);
    }
    #logos2-{{ section.id }} .l2up-item{
      /* 2 visibles al mismo tiempo */
      flex:0 0 calc((100% - var(--gap)) / var(--visible));
      display:flex; align-items:center; justify-content:center;
      min-height:64px;
    }
    #logos2-{{ section.id }} .l2up-img{
      max-height:var(--img-h); max-width:100%;
      width:auto; height:auto; object-fit:contain;
      /* Colores originales: sin filtros */
      filter: none;
    }
    @media (max-width: 640px){
      #logos2-{{ section.id }}.l2up{ --gap:16px; --img-h:36px; }
    }
  </style>

  <script>
    (function(){
      const root  = document.getElementById('logos2-{{ section.id }}');
      if(!root) return;

      const track = root.querySelector('.l2up-track');
      let items   = Array.from(root.querySelectorAll('.l2up-item'));
      const visible = 2;

      if (items.length <= visible) return; // no hace falta desplazar

      // Duplicar todos los items para un bucle fluido
      items.forEach(el => track.appendChild(el.cloneNode(true)));

      // Recalcular la lista completa (originales + clones)
      items = Array.from(track.children);

      let index = 0;
      const interval = parseInt({{ section.settings.interval | default: 5000 }}) || 5000;

      // Calcular el paso en píxeles (ancho de un item + gap)
      function getStepPx(){
        const first = items[0];
        const gapPx = parseFloat(getComputedStyle(track).gap) || 0;
        return first.getBoundingClientRect().width + gapPx;
      }

      function go(i, animate = true){
        track.style.transition = animate ? 'transform .6s ease' : 'none';
        const step = getStepPx();
        track.style.transform = 'translateX(' + (-i * step) + 'px)';
      }

      // Al llegar al final de los originales, reiniciar discretamente
      track.addEventListener('transitionend', () => {
        if (index >= (items.length / 2)) {
          index = 0;
          go(index, false); // reinicio instantáneo
        }
      });

      let timer = setInterval(() => {
        index += 1;          // paso de 1 logo
        go(index, true);     // nuevo slide entra desde la derecha
      }, interval);

      // Pausa al pasar el ratón
      root.addEventListener('mouseenter', ()=> clearInterval(timer));
      root.addEventListener('mouseleave', ()=>{
        clearInterval(timer);
        timer = setInterval(() => { index += 1; go(index, true); }, interval);
      });

      // Posición inicial
      go(0, false);
    })();
  </script>
</section>

{% schema %}
{
  "name": "Logos 2up",
  "settings": [
    {
      "type": "number",
      "id": "interval",
      "label": "Intervalo (ms)",
      "default": 5000,
      "info": "Tiempo entre desplazamientos (p. ej.: 5000 = 5 s)"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        { "type": "image_picker", "id": "logo", "label": "Imagen del logo" },
        { "type": "text", "id": "alt", "label": "Texto alternativo", "default": "Logotipo" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [{ "name": "Logos 2up" }]
}
{% endschema %}
